## Первый блок
**Лог** и **метрика** — это разные концепции в контексте мониторинга и анализа данных, хотя они часто используются вместе в системах аналитики и мониторинга.

### Отличия лога от метрики:

1. **Лог**:
    - **Определение**: Лог — это запись событий, происходящих в системе, обычно с временной меткой и деталями о событии. Это сырые данные, описывающие конкретные действия или состояния.
    - **Характеристики**:
        - Детализированные, содержат полную информацию о событии (например, кто, что, когда сделал).
        - Хранятся в виде текстовых записей или структурированных данных (JSON, например).
        - Используются для диагностики, отладки и анализа конкретных инцидентов.
        - Объем данных может быть большим, так как логи фиксируют каждое событие.
    - **Пример**:
                
        `2025-06-15 21:44:32 [ERROR] Failed to connect to database: timeout`
        
        Это строка лога, которая описывает конкретную ошибку с указанием времени и причины.
2. **Метрика**:
    - **Определение**: Метрика — это агрегированные числовые данные, которые измеряют определённые характеристики системы или процесса за период времени. Они представляют собой количественные показатели.
    - **Характеристики**:
        - Агрегированные и компактные (например, среднее, сумма, количество событий).
        - Используются для мониторинга трендов, производительности и состояния системы.
        - Хранятся в виде временных рядов (time series) для анализа тенденций.
        - Меньший объем данных по сравнению с логами.
    - **Пример**:
        - Количество запросов к серверу за минуту: 150 req/min.
        - Среднее время ответа API: 200 ms.
        - Процент ошибок: 2.5%.

### Ключевые различия:

|**Аспект**|**Лог**|**Метрика**|
|---|---|---|
|**Формат**|Текстовый/структурированный, детализированный|Числовой, агрегированный|
|**Цель**|Диагностика, отладка, аудит|Мониторинг, анализ трендов|
|**Объем данных**|Большой, детализированный|Компактный, агрегированный|
|**Пример использования**|Поиск причины сбоя в приложении|Отслеживание нагрузки на сервер|

### Примеры метрик:

1. **Системные метрики**:
    - Использование CPU: 75%.
    - Объем свободной памяти: 2 GB.
    - Количество активных пользователей: 1000.
2. **Метрики приложения**:
    - Среднее время обработки запроса: 150 ms.
    - Количество ошибок 500 за час: 10.
    - Количество успешных транзакций: 500 tx/min.
3. **Бизнес-метрики**:
    - Конверсия на сайте: 3.2%.
    - Средний чек покупки: 50 USD.
    - Количество регистраций за день: 200.
4. **Метрики инфраструктуры**:
    - Задержка сети: 10 ms.
    - Количество запросов в базу данных: 1000 req/s.
    - Процент доступности сервиса: 99.9%.

### Итог:

Логи дают контекст и детали для анализа конкретных событий, а метрики — это обобщённые показатели для мониторинга и оценки производительности. Часто они используются вместе: логи помогают разобраться в причинах аномалий, выявленных через метрики.
## Второй блок
### Чем отличаются Zabbix и Prometheus?

**Zabbix** и **Prometheus** — это популярные системы мониторинга IT-инфраструктуры, но они имеют разные подходы, архитектуру и сценарии использования. Вот основные отличия:

1. **Архитектура и модель сбора данных**:
    - **Zabbix**:
        - Комплексное решение "всё в одном", включающее сбор данных, хранение, анализ, визуализацию и оповещения.
        - Использует **push-модель**: агенты Zabbix (или безагентные методы) отправляют данные на сервер.
        - Поддерживает сбор данных через агентов, SNMP, IPMI, JMX, HTTP-запросы, ODBC, ICMP, TCP и пользовательские скрипты.[
        - Хранит данные в реляционных базах данных (MySQL, PostgreSQL, Oracle, SQLite).[

    - **Prometheus**:
        - Модульная система, ориентированная на временные ряды (time-series database, TSDB).
        - Использует **pull-модель**: Prometheus сам запрашивает метрики у конечных точек (эндпоинтов) через HTTP.
        - Работает с экспортерами (например, Node Exporter, MySQL Exporter) для сбора метрик от систем, не поддерживающих формат Prometheus.
        - Хранит данные в собственной TSDB, оптимизированной для временных рядов.
2. **Визуализация**:
    - **Zabbix**:
        - Имеет встроенный веб-интерфейс с настраиваемыми дашбордами, графиками, картами и отчётами. Не требует дополнительных инструментов для визуализации.
    - **Prometheus**:
        - Имеет базовый веб-интерфейс (Expression Browser) для просмотра метрик, но он ограничен по функциональности.
        - Обычно используется с **Grafana** для мощной и гибкой визуализации.
3. **Типы данных**:
    - **Zabbix**:
        - Подходит для мониторинга логов, текстовых данных, событий и числовых метрик.
        - Гибко работает с различными типами данных, включая строки и журналы событий.
    - **Prometheus**:
        - Ориентирован на числовые метрики (временные ряды). Не подходит для хранения текстовых логов или журналов событий без дополнительных инструментов, таких как Loki.
4. **Масштабируемость**:
    - **Zabbix**:
        - Хорошо подходит для гетерогенных инфраструктур, но может испытывать проблемы с производительностью при больших объемах данных.
        - Требует мощной базы данных для масштабирования.
    - **Prometheus**:
        - Разработан для высоконагруженных и динамических систем (например, микросервисов и Kubernetes).
        - Легче масштабируется за счёт модульности и интеграции с внешними хранилищами (например, VictoriaMetrics).
5. **Оповещения**:
    - **Zabbix**:
        - Имеет встроенную систему триггеров и оповещений, настраиваемых через веб-интерфейс. Поддерживает отправку уведомлений через email, SMS, Telegram и др.
    - **Prometheus**:
        - Использует **Alertmanager** для обработки оповещений, который требует отдельной настройки. Поддерживает интеграцию с мессенджерами, email и другими системами.
6. **Язык запросов**:
    - **Zabbix**:
        - Не имеет мощного языка запросов, анализ данных осуществляется через встроенные триггеры и функции.
    - **Prometheus**:
        - Использует **PromQL** (Prometheus Query Language) — мощный язык запросов для анализа временных рядов.
7. **Сценарии использования**:
    - **Zabbix**:
        - Подходит для традиционных IT-инфраструктур, мониторинга серверов, сетевого оборудования и клиентских приложений.
        - Удобен для организаций, которым нужно готовое решение "из коробки".
    - **Prometheus**:
        - Идеален для облачных и микросервисных архитектур, особенно с Kubernetes.
        - Требует больше настройки, но более гибок для современных инфраструктур.
8. **Лицензия**:
    - Оба инструмента — open source. Zabbix распространяется под GNU GPL v2, Prometheus — под Apache License 2.0.

### Что такое Grafana?

**Grafana** — это платформа с открытым исходным кодом для визуализации и анализа данных, которая не собирает и не хранит данные сама по себе, а подключается к различным источникам данных и отображает их в виде интерактивных дашбордов, графиков, тепловых карт, гистограмм и других визуализаций. Используется для мониторинга IT-инфраструктуры, бизнес-метрик и аналитики.

- **Основные особенности**:
    - Поддержка множества источников данных через плагины.
    - Гибкие дашборды с возможностью кастомизации.
    - Интеграция с системами оповещений (например, через Alertmanager для Prometheus или встроенные алерты).
    - Лицензия: GNU AGPL v3 (бесплатно).

### Какие источники данных поддерживает Grafana?

Grafana поддерживает широкий спектр источников данных "из коробки" и через сторонние плагины. Основные источники данных включают:

1. **Базы данных временных рядов**:
    - **Prometheus**
    - **InfluxDB**
    - **Graphite**
    - **OpenTSDB**
    - **VictoriaMetrics**
    - **TimescaleDB**
2. **Реляционные базы данных**:
    - **MySQL**
    - **PostgreSQL**
    - **Microsoft SQL Server**
    - **SQLite**
3. **Логи и журналы событий**:
    - **Loki** (для логов, оптимизированный для работы с Prometheus)
    - **Elasticsearch**
4. **Мониторинговые системы**:
    - **Zabbix** (через плагин, например, alexanderzobnin-zabbix-app)
    - **PRTG**
    - **Nagios**
5. **Облачные сервисы**:
    - **AWS CloudWatch**
    - **Azure Monitor**
    - **Google Cloud Monitoring**
6. **Другие источники**:
    - **ClickHouse**
    - **KairosDB**
    - **JSON API** (для пользовательских HTTP-запросов)
    - **CSV** и другие текстовые данные через плагины

Полный список источников данных доступен в официальной документации Grafana, и он может быть расширен сторонними плагинами.

### Итог:

- **Zabbix** — универсальное решение для мониторинга с упором на простоту настройки и встроенные инструменты визуализации, лучше подходит для традиционных инфраструктур.
- **Prometheus** — модульная система для современных облачных и микросервисных архитектур, с мощным языком запросов и интеграцией с Grafana.
- **Grafana** — универсальный инструмент визуализации, который интегрируется с обоими системами и множеством других источников данных, обеспечивая гибкость и красивые дашборды.
## Третий блок
### Как установить и настроить Zabbix-агент?

**Zabbix-агент** — это программное обеспечение, которое устанавливается на хост для сбора данных (метрик, логов, состояния системы) и отправки их на Zabbix-сервер. Вот пошаговая инструкция по установке и настройке Zabbix-агента на Linux (на примере Ubuntu/Debian, для других ОС процесс схож, но команды могут отличаться).

#### 1. **Установка Zabbix-агента**

- **Шаг 1: Добавление репозитория Zabbix**
    1. Проверьте версию Zabbix-сервера, чтобы установить совместимую версию агента. Например, для Zabbix 6.0 LTS:
        
        
        
        `wget https://repo.zabbix.com/zabbix/6.0/ubuntu/pool/main/z/zabbix-release/zabbix-release_6.0-4+ubuntu$(lsb_release -rs)_all.deb sudo dpkg -i zabbix-release_6.0-4+ubuntu$(lsb_release -rs)_all.deb`
        
    2. Обновите список пакетов:
        
        
        
        `sudo apt update`
        
- **Шаг 2: Установка агента** Установите пакет zabbix-agent (или zabbix-agent2 для более новой версии с поддержкой плагинов):
    
    bash
    
    
    
    `sudo apt install zabbix-agent`
    
    Для CentOS/RHEL:
    
    bash
    
    
    
    `sudo yum install https://repo.zabbix.com/zabbix/6.0/rhel/8/x86_64/zabbix-agent-6.0.0-1.el8.x86_64.rpm sudo yum install zabbix-agent`
    
- **Шаг 3: Настройка Zabbix-агента**
    1. Отредактируйте файл конфигурации агента:
        
        bash
        
        
        
        `sudo nano /etc/zabbix/zabbix_agentd.conf`
        
        Основные параметры для настройки:
        
        - Server=IP_или_домен_Zabbix_сервера — адрес Zabbix-сервера для активного мониторинга.
        - ServerActive=IP_или_домен_Zabbix_сервера — адрес для активного режима (агент сам отправляет данные).
        - Hostname=Имя_хоста — имя хоста, которое будет отображаться в Zabbix (должно совпадать с именем в веб-интерфейсе Zabbix).
        - ListenPort=10050 — порт, на котором агент принимает запросы (по умолчанию). Пример:
        
        text
        
        
        
        `Server=192.168.1.100 ServerActive=192.168.1.100 Hostname=MyServer`
        
- **Шаг 4: Запуск и включение агента**
    1. Запустите агент:
        
        bash
        
        
        
        `sudo systemctl start zabbix-agent`
        
    2. Включите автозапуск:
        
        bash
        
        
        
        `sudo systemctl enable zabbix-agent`
        
    3. Проверьте статус:
        
        bash
        
                
        `sudo systemctl status zabbix-agent`
        
- **Шаг 5: Настройка брандмауэра (если используется)** Разрешите входящие подключения на порт 10050:
    
    bash
    
        
    `sudo ufw allow 10050/tcp`
    
- **Шаг 6: Добавление хоста в Zabbix**
    1. В веб-интерфейсе Zabbix перейдите в **Configuration → Hosts → Create host**.
    2. Укажите:
        - Hostname (то же, что в конфигурации агента).
        - Groups (группа хостов).
        - Interfaces (IP-адрес и порт 10050).
    3. Привяжите шаблоны мониторинга (например, "Linux by Zabbix agent").
    4. Сохраните и проверьте, поступают ли данные (в разделе **Monitoring → Latest data**).
- **Шаг 7: Тестирование** Проверьте связь с агентом с помощью команды на сервере:
    
    
    `zabbix_get -s <IP_хоста> -p 10050 -k "system.cpu.load[all,avg1]"`
    
    Это вернёт значение загрузки CPU, если агент работает корректно.

#### Полезные советы:

- Для более сложных сценариев используйте zabbix-agent2, который поддерживает плагины (например, для мониторинга Docker, MySQL).
- Настройте шифрование соединения (PSK или TLS) для безопасности.
- Логи агента находятся в /var/log/zabbix/zabbix_agentd.log — полезно для отладки.

---

### Что такое Prometheus Exporter?

**Prometheus Exporter** — это специализированное приложение или скрипт, который собирает метрики из системы, приложения или сервиса и преобразует их в формат, понятный Prometheus (обычно в виде HTTP-эндпоинта /metrics). Prometheus запрашивает эти метрики по протоколу HTTP (pull-модель).

#### Основные характеристики:

- **Назначение**: Экспортеры делают системы, не поддерживающие нативно формат Prometheus, доступными для мониторинга.
- **Как работает**:
    1. Экспортер собирает данные (например, через API, команды ОС, базы данных).
    2. Преобразует их в формат Prometheus (ключ-значение с временными рядами).
    3. Предоставляет данные через HTTP-эндпоинт (обычно /metrics).
    4. Prometheus периодически опрашивает этот эндпоинт.
- **Примеры экспортеров**:
    - **Node Exporter**: Собирает метрики ОС (CPU, память, диск, сеть).
    - **MySQL Exporter**: Метрики производительности MySQL (запросы, задержки, ошибки).
    - **Blackbox Exporter**: Мониторинг доступности эндпоинтов (HTTP, DNS, ICMP).
    - **Apache Exporter**: Метрики веб-сервера Apache.
- **Пример данных от экспортера** (в формате Prometheus):
    
        
    `node_cpu_seconds_total{cpu="0",mode="system"} 123.45 node_memory_MemAvailable_bytes 1048576000`
    

#### Использование:

1. Установите экспортер (например, node_exporter):
    
    
    
    `wget https://github.com/prometheus/node_exporter/releases/download/v1.8.1/node_exporter-1.8.1.linux-amd64.tar.gz tar xvfz node_exporter-1.8.1.linux-amd64.tar.gz cd node_exporter-1.8.1.linux-amd64 ./node_exporter &`
    
2. Настройте Prometheus для опроса экспортера (в файле prometheus.yml):
    
    
    
    `scrape_configs: - job_name: 'node' static_configs: - targets: ['localhost:9100']`
    
3. Перезапустите Prometheus и проверьте метрики в веб-интерфейсе.

---

### Что такое Prometheus Pushgateway?

**Prometheus Pushgateway** — это компонент Prometheus, который позволяет временно хранить метрики от систем, которые не могут быть опрошены напрямую Prometheus (например, из-за краткосрочных задач, батчевых процессов или отсутствия постоянного HTTP-эндпоинта). Pushgateway используется в **push-модели**, в отличие от стандартной pull-модели Prometheus.

#### Основные характеристики:

- **Назначение**: Принимает метрики, отправленные клиентами, и предоставляет их Prometheus для последующего опроса.
- **Когда используется**:
    - Для краткосрочных задач (batch jobs), которые завершаются до следующего опроса Prometheus.
    - Для систем, где pull-модель невозможна (например, за NAT или в сложных сетевых конфигурациях).
- **Как работает**:
    1. Клиент отправляет метрики в Pushgateway по HTTP (POST-запросы).
    2. Pushgateway хранит метрики в памяти.
    3. Prometheus периодически опрашивает Pushgateway (как обычный эндпоинт /metrics).
- **Пример использования**:
    - Скрипт завершает задачу и отправляет метрику (например, время выполнения) в Pushgateway:
           
        `echo "job_duration_seconds 42" | curl --data-binary @- http://pushgateway:9091/metrics/job/my_job`
        
    - Prometheus настроен на опрос Pushgateway:
        
        yaml
           
        `scrape_configs: - job_name: 'pushgateway' static_configs: - targets: ['pushgateway:9091']`
        

#### Ограничения:

- Pushgateway не предназначен для постоянного мониторинга, так как метрики могут накапливаться и требуют ручной очистки.
- Рекомендуется использовать pull-модель с экспортерами, если это возможно, для большей надёжности и простоты.

---

### Итог:

- **Zabbix-агент** — это агент для сбора данных и отправки их на Zabbix-сервер. Установка включает добавление репозитория, настройку конфигурации и запуск службы.
- **Prometheus Exporter** — приложение, преобразующее метрики системы или сервиса в формат Prometheus для pull-модели мониторинга.
- **Prometheus Pushgateway** — промежуточный сервис для хранения метрик от краткосрочных задач, которые затем опрашиваются Prometheus.